{#
 # -------------------------------------------------------------------------
 # Escalade plugin for GLPI
 # -------------------------------------------------------------------------
 #
 # LICENSE
 #
 # This file is part of Escalade.
 #
 # Escalade is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
 #
 # Escalade is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with Escalade. If not, see <http://www.gnu.org/licenses/>.
 # -------------------------------------------------------------------------
 # @copyright Copyright (C) 2015-2023 by Escalade plugin team.
 # @license   GPLv2 https://www.gnu.org/licenses/gpl-2.0.html
 # @link      https://github.com/pluginsGLPI/escalade
 # -------------------------------------------------------------------------
 #}

{% import "components/form/fields_macros.html.twig" as fields %}

{% if canedit %}
    <form method="post" id="manageGroup" action="{{ formurl }}">
        {{ fields.dropdownField(
            'Group',
            'groups_id_destination',
            '',
            __('Add a group'),
            {
                'used': used,
                'rand': rand,
            }
        ) }}
        <input type="hidden" name="groups_id_source" value="{{ group_id }}">
        <input type="hidden" name="_glpi_csrf_token" value="{{ csrf_token() }}">
        <div class="hstack gap-1">
            <div class="pe-5 ms-auto">
                <button class="btn btn-primary" type="submit" name="addgroup" value="1">
                    <i class="ti ti-plus"></i>
                    <span>{{ _x('button', 'Add') }}</span>
                </button>
            </div>
        </div>
    </form>
    {% if groups is not empty %}
        <div class="hr-text">
            <i class="fa-2x ti ti-users-group"></i>
            <span>{{ __('List of groups to escalate', 'escalade') }}</span>
        </div>
        {% set datatable_params = {
            'is_tab': true,
            'nopager': true,
            'nofilter': true,
            'nosort': true,
            'columns': {
                'name': __('Name'),
                'comment': _n('Comment', 'Comments', 1),
            },
            'formatters': {
                'name': 'raw_html',
            },
            'entries': groups,
            'total_number': groups|length,
            'filtered_number': groups|length,
            'showmassiveactions': canedit,
            'massiveactionparams': massiveactionparams
        } %}

        {{ include('components/datatable.html.twig', datatable_params, with_context = false) }}
    {% endif %}
{% endif %}

{# {% if is_granted('group', 'update') and nb %}
    {% set rand = random() %}
    {% set massiveactionparams = {
        'num_displayed': min(nb, app.session.glpilist_limit),
        'container': 'mass' ~ _self|class_basename ~ rand
    } %}
    {{ form_start(massiveActionForm) }}
    {% if nb > 10 %}
        {{ form_widget(massiveActionForm) }}
    {% endif %}
    <table class="tab_cadre_fixe">
        <tr>
            <th width="20">{{ form_widget(massiveActionForm.mass_all) }}</th>
            <th>{{ 'group'|trans }}</th>
        </tr>
        {% for gg_id, gg in gg_found %}
            <tr class="tab_bg_1">
                <td>
                    {% if is_granted('group', 'update') %}
                        {{ form_widget(massiveActionForm.mass[gg_id]) }}
                    {% endif %}
                </td>
                <td>{{ group.getLink() }}</td>
            </tr>
        {% endfor %}
    </table>
    {% if nb > 10 %}
        {% if massiveactionparams.ontop is not defined %}
            {{ form_widget(massiveActionForm) }}
        {% endif %}
    {% endif %}
    {{ form_end(massiveActionForm) }}
{% endif %} #}